<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 min-h-screen p-6">
  <h1 class="text-3xl font-bold text-blue-700 mb-6">Welcome Admin ðŸŽ‰</h1>

  <!-- Top Controls -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-xl font-semibold">Dashboard</h2>
    <button onclick="logoutAdmin()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Logout</button>
  </div>

  <!-- Quick Stats -->
  <div class="grid grid-cols-1 sm:grid-cols-5 gap-4 mb-6">
    <div class="bg-white shadow p-4 rounded text-center">
      <h3 class="text-lg font-bold">Total Orders</h3>
      <p id="totalOrders" class="text-2xl text-blue-600">0</p>
    </div>
    <div class="bg-white shadow p-4 rounded text-center">
      <h3 class="text-lg font-bold">Pending</h3>
      <p id="pendingOrders" class="text-2xl text-orange-600">0</p>
    </div>
    <div class="bg-white shadow p-4 rounded text-center">
      <h3 class="text-lg font-bold">Approved</h3>
      <p id="approvedOrders" class="text-2xl text-green-600">0</p>
    </div>
    <div class="bg-white shadow p-4 rounded text-center">
      <h3 class="text-lg font-bold">Rejected</h3>
      <p id="rejectedOrders" class="text-2xl text-red-600">0</p>
    </div>
    <div class="bg-white shadow p-4 rounded text-center">
      <h3 class="text-lg font-bold">Products</h3>
      <p id="totalProducts" class="text-2xl text-indigo-600">0</p>
    </div>
  </div>

  <!-- Product Management -->
  <section class="mb-10">
    <h2 class="text-2xl font-semibold mb-4">Manage Products</h2>
    <button onclick="showAddProductForm()" class="bg-blue-600 text-white px-4 py-2 rounded mb-4">+ Add Product</button>
    <div id="productForm" class="hidden bg-white shadow p-4 rounded mb-4">
      <input id="prodName" placeholder="Product Name" class="border p-2 rounded w-full mb-2">
      <input id="prodPrice" type="number" placeholder="Price" class="border p-2 rounded w-full mb-2" min="1">
      <input id="prodStock" type="number" placeholder="Stock" class="border p-2 rounded w-full mb-2" min="0">
      <input id="prodExpiry" type="date" class="border p-2 rounded w-full mb-2">
      <button onclick="saveProduct()" class="bg-green-600 text-white px-4 py-2 rounded">Save Product</button>
      <span id="prodFormError" class="text-red-600 text-sm mt-2"></span>
    </div>
    <div id="adminProductsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4"></div>
  </section>

  <!-- Orders Management -->
  <section>
    <h2 class="text-2xl font-semibold mb-4">Manage Orders</h2>
    <table class="w-full border-collapse bg-white shadow rounded mt-4">
      <thead>
        <tr class="bg-gray-100">
          <th class="border p-2">Order ID</th>
          <th class="border p-2">Customer</th>
          <th class="border p-2">Items</th>
          <th class="border p-2">Total</th>
          <th class="border p-2">Status</th>
          <th class="border p-2">Actions</th>
        </tr>
      </thead>
      <tbody id="ordersTable"></tbody>
    </table>
  </section>

  <script>
    // --- Products List ---
    let products = JSON.parse(localStorage.getItem("products") || "[]");
    if (!products || products.length === 0) {
      products = [
        { id: 1, name: "NEUROBION FORTE INJ", price: 21.77, stock: 90, hsn: "30045010", image: "", expiry: "" },
        { id: 2, name: "Dolo-650", price: 30, stock: 5, hsn: "30045010", image: "", expiry: "" }
      ];
      localStorage.setItem("products", JSON.stringify(products));
    }

    // --- ORDER ID Generator ---
    function generateOrderID() {
      let last = localStorage.getItem("lastOrderNumber") || "6";
      let next = parseInt(last) + 1;
      localStorage.setItem("lastOrderNumber", next);
      return "ENIPSEE" + String(next).padStart(4, "0");
    }

    // --- Product Management ---
    function renderAdminDashboard() {
      const grid = document.getElementById("adminProductsGrid");
      grid.innerHTML = "";
      products.forEach(p => {
        grid.innerHTML += `
          <div class="bg-white shadow rounded p-4">
            <h3 class="font-bold mb-1">${p.name}</h3>
            <div>Price: â‚¹${p.price}</div>
            <div>Stock: ${p.stock}</div>
            ${p.expiry ? `<div>Expiry: ${p.expiry}</div>` : ""}
            <div class="mt-2 flex gap-2">
              <button onclick="editProduct(${p.id})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
              <button onclick="deleteProduct(${p.id})" class="bg-red-500 text-white px-2 py-1 rounded">Delete</button>
            </div>
          </div>
        `;
      });
    }

    function showAddProductForm() {
      document.getElementById("productForm").classList.toggle("hidden");
      document.getElementById("prodFormError").textContent = "";
    }

    function saveProduct() {
      const name = document.getElementById("prodName").value.trim();
      const price = parseFloat(document.getElementById("prodPrice").value);
      const stock = parseInt(document.getElementById("prodStock").value);
      const expiry = document.getElementById("prodExpiry").value.trim();
      const errorSpan = document.getElementById("prodFormError");

      if (!name || isNaN(price) || price <= 0 || isNaN(stock) || stock < 0) {
        errorSpan.textContent = "Please fill all fields correctly.";
        return;
      }

      products.push({ id: Date.now(), name, price, stock, expiry, image: "", hsn: "00000000" });
      localStorage.setItem("products", JSON.stringify(products));
      errorSpan.textContent = "";
      alert("âœ… Product saved!");
      renderAdminDashboard();
      updateAdminStats();

      document.getElementById("productForm").classList.add("hidden");
      document.getElementById("prodName").value = "";
      document.getElementById("prodPrice").value = "";
      document.getElementById("prodStock").value = "";
      document.getElementById("prodExpiry").value = "";
    }

    // --- Orders Table ---
    function renderAdminOrdersTable() {
      let orders = JSON.parse(localStorage.getItem("orderHistory") || "[]");
      const tbody = document.getElementById("ordersTable");
      tbody.innerHTML = "";

      orders.reverse().forEach((order, index) => {
        if (!order.id) {
          order.id = generateOrderID();
        }
        tbody.innerHTML += `
          <tr>
            <td class="border p-2">${order.id}</td>
            <td class="border p-2">${order.name} <br>${order.phone}</td>
            <td class="border p-2">
              <ul>${order.items.map(i => `<li>${i.name} Ã— ${i.quantity}</li>`).join("")}</ul>
            </td>
            <td class="border p-2">â‚¹${order.total}</td>
            <td class="border p-2" id="status_${order.id}">${order.status || "Pending"}</td>
            <td class="border p-2 flex gap-2">
              <button onclick="approveOrder('${order.id}')" class="bg-green-600 text-white px-2 py-1 rounded">Approve</button>
              <button onclick="rejectOrder('${order.id}')" class="bg-red-600 text-white px-2 py-1 rounded">Reject</button>
              <button onclick="nextStep('${order.id}')" class="bg-blue-600 text-white px-2 py-1 rounded">Next Step</button>
            </td>
          </tr>
        `;
      });

      localStorage.setItem("orderHistory", JSON.stringify(orders));
    }

    // --- Status Flow ---
    function approveOrder(orderId) {
      let orders = JSON.parse(localStorage.getItem("orderHistory") || "[]");
      const idx = orders.findIndex(o => o.id === orderId);
      if (idx >= 0) {
        orders[idx].status = "Pack Ready (Waiting for Pickup)";
        localStorage.setItem("orderHistory", JSON.stringify(orders));
        document.getElementById(`status_${orderId}`).textContent = orders[idx].status;
        updateAdminStats();
      }
    }

    function rejectOrder(orderId) {
      let orders = JSON.parse(localStorage.getItem("orderHistory") || "[]");
      const idx = orders.findIndex(o => o.id === orderId);
      if (idx >= 0) {
        orders[idx].status = "Rejected";
        localStorage.setItem("orderHistory", JSON.stringify(orders));
        document.getElementById(`status_${orderId}`).textContent = "Rejected";
        updateAdminStats();
      }
    }

    function nextStep(orderId) {
      let orders = JSON.parse(localStorage.getItem("orderHistory") || "[]");
      const idx = orders.findIndex(o => o.id === orderId);
      if (idx >= 0) {
        let current = orders[idx].status;
        if (current === "Pack Ready (Waiting for Pickup)") {
          orders[idx].status = "Out for Delivery";
        } else if (current === "Out for Delivery") {
          orders[idx].status = "Delivered";
        }
        localStorage.setItem("orderHistory", JSON.stringify(orders));
        document.getElementById(`status_${orderId}`).textContent = orders[idx].status;
        updateAdminStats();
      }
    }

    // --- Stats Update ---
    function updateAdminStats() {
      document.getElementById("totalProducts").textContent = products.length;
      const orders = JSON.parse(localStorage.getItem("orderHistory") || "[]");
      document.getElementById("totalOrders").textContent = orders.length;
      document.getElementById("pendingOrders").textContent = orders.filter(o => !o.status || o.status === "Pending").length;
      document.getElementById("approvedOrders").textContent = orders.filter(o => o.status && o.status.includes("Pack Ready")).length;
      document.getElementById("rejectedOrders").textContent = orders.filter(o => o.status === "Rejected").length;
    }

    // --- Logout ---
    function logoutAdmin() {
      window.location.href = "admin.html";
    }

    // --- INIT ---
    window.addEventListener("DOMContentLoaded", function() {
      renderAdminDashboard();
      renderAdminOrdersTable();
      updateAdminStats();
    });
  </script>
</body>
</html>
